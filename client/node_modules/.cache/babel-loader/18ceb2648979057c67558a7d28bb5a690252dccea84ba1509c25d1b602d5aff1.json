{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import axios from'axios';import jwt_decode from'jwt-decode';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const checkToken=async()=>{const token=localStorage.getItem('token');if(token){try{// Vérifier si le token est expiré\nconst decoded=jwt_decode(token);const currentTime=Date.now()/1000;if(decoded.exp<currentTime){// Token expiré\nlocalStorage.removeItem('token');setIsAuthenticated(false);setCurrentUser(null);}else{// Token valide\nsetCurrentUser(decoded);setIsAuthenticated(true);}}catch(error){// Token invalide\nlocalStorage.removeItem('token');setIsAuthenticated(false);setCurrentUser(null);}}setLoading(false);};checkToken();},[]);const login=async(email,password)=>{try{const response=await axios.post('/api/auth/login',{email,password});const{token,user}=response.data;localStorage.setItem('token',token);setCurrentUser(user);setIsAuthenticated(true);setError(null);return true;}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Erreur de connexion');return false;}};const logout=()=>{localStorage.removeItem('token');setCurrentUser(null);setIsAuthenticated(false);};return/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(AuthContext.Provider,{value:{currentUser,isAuthenticated,loading,error,login,logout},children:children})});};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","jwt_decode","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","isAuthenticated","setIsAuthenticated","loading","setLoading","error","setError","checkToken","token","localStorage","getItem","decoded","currentTime","Date","now","exp","removeItem","login","email","password","response","post","user","data","setItem","_error$response","_error$response$data","message","logout","Fragment","Provider","value"],"sources":["/workspaces/app-booking/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\nimport axios from 'axios';\nimport jwt_decode from 'jwt-decode';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const checkToken = async () => {\n      const token = localStorage.getItem('token');\n      \n      if (token) {\n        try {\n          // Vérifier si le token est expiré\n          const decoded = jwt_decode(token);\n          const currentTime = Date.now() / 1000;\n          \n          if (decoded.exp < currentTime) {\n            // Token expiré\n            localStorage.removeItem('token');\n            setIsAuthenticated(false);\n            setCurrentUser(null);\n          } else {\n            // Token valide\n            setCurrentUser(decoded);\n            setIsAuthenticated(true);\n          }\n        } catch (error) {\n          // Token invalide\n          localStorage.removeItem('token');\n          setIsAuthenticated(false);\n          setCurrentUser(null);\n        }\n      }\n      \n      setLoading(false);\n    };\n    \n    checkToken();\n  }, []);\n\n  const login = async (email, password) => {\n    try {\n      const response = await axios.post('/api/auth/login', { email, password });\n      const { token, user } = response.data;\n      \n      localStorage.setItem('token', token);\n      setCurrentUser(user);\n      setIsAuthenticated(true);\n      setError(null);\n      \n      return true;\n    } catch (error) {\n      setError(error.response?.data?.message || 'Erreur de connexion');\n      return false;\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    setCurrentUser(null);\n    setIsAuthenticated(false);\n  };\n\n  return (\n    <React.Fragment>\n      <AuthContext.Provider value={{ currentUser, isAuthenticated, loading, error, login, logout }}>\n        {children}\n      </AuthContext.Provider>\n    </React.Fragment>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}